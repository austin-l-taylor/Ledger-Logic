<!-- This is the page for THE chart of accounts -->
{% extends "main_page/base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col">
            <h2 class="text-center">Chart of Accounts</h2>
        </div>
        <div class="col text-end"> <!-- Align the button to the right -->
            {% if request.user.is_superuser %}
            <!-- Button to view log changes -->
            <a href="{% url 'view_coa_logs' %}" class="btn btn-outline-primary" title="view log changes">View Changes</a>
            {% endif %}
        </div>
    </div>

    <!-- Search Form -->
    <form method="GET" class="mb-3">
        <div class="input-group">
            <input type="text" name="q" class="form-control" placeholder="Search accounts..." value="{{ request.GET.q }}">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="submit" title="search accounts" >Search</button>
            </div>
        </div>
    </form>

    <!-- table wrapper -->
    <div class="table-responsive">
        <!-- Chart of Accounts Table -->
        <table class="table table-striped table-hover table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>Account Name</th>
                    <th>Account Number</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Subcategory</th>
                    <th>Normal Side</th>
                    <th>Initial Balance</th>
                    <th>Debit</th>
                    <th>Credit</th>
                    <th>Balance</th>
                    <th>Date Added</th>
                    <th>Comments</th>
                    <th>Status</th>
                    {% if is_admin %}
                    <th>Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for account in accounts %}
                <tr>
                    <td><a href="{% url 'ledger' account.id %}">{{ account.account_name }}</a></td>
                    <td>{{ account.account_number }}</td>
                    <td>{{ account.account_description }}</td>
                    <td>{{ account.account_category }}</td>
                    <td>{{ account.account_subcategory }}</td>
                    <td>{{ account.normal_side }}</td>
                    <td>{{ account.initial_balance }}</td>
                    <td>{{ account.debit }}</td>
                    <td>{{ account.credit }}</td>
                    <td>{{ account.balance }}</td>
                    <td>{{ account.date_time_account_added }}</td>
                    <td>{{ account.comment }}</td>
                    <td>{{ account.is_active|yesno:"Active,Inactive" }}</td>
                    {% if is_admin %}
                    <td>
                        <a href="{% url 'edit_account' account.id %}">Edit</a> |
                        {% if account.is_active %}
                            <a href="{% url 'deactivate_account' account.id %}">Deactivate</a>
                        {% else %}
                            <a href="{% url 'activate_account' account.id %}">Activate</a>
                        {% endif %}
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Buttons at the bottom of the Chart of Accounts -->
<div class="text-center mt-3"> <!-- Center the buttons and add some top margin -->
    <!-- Add New Account Button but only for admins -->
    {% if is_admin %}
    <a href="{% url 'add_account' %}" class="btn btn-success" title="add new account" >Add New Account</a>
    {% endif %}
    
    <!-- Clear Search Button -->
    <a href="{% url 'chart_of_accounts' %}" class="btn btn-secondary ml-2" title="clear current search">Clear Search</a>
</div>

<!-- some custom styles to the table -->
<style>
    .thead-dark th {
        background-color: #23395D; /* Dark table header background */
        color: white; /* White text color */
        padding: 5px; /* Smaller padding due to screen sizes*/
        font-size: 0.85rem; /* Smaller font size */
    }
    
    th {
        white-space: nowrap; /* Prevent text in headers from wrapping */
    }
</style>

{% endblock %}
